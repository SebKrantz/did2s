<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/3/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Two-Stage-Difference-in-Differences • did2s</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/3/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/3/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Two-Stage-Difference-in-Differences">
<meta property="og:description" content="did2s">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">did2s</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Two-Stage-Difference-in-Differences.html">Two-Stage-Difference-in-Differences</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Two-Stage-Difference-in-Differences_files/header-attrs-2.8/header-attrs.js"></script><link href="Two-Stage-Difference-in-Differences_files/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="Two-Stage-Difference-in-Differences_files/pagedtable-1.1/js/pagedtable.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Two-Stage-Difference-in-Differences</h1>
            
      
      
      <div class="hidden name"><code>Two-Stage-Difference-in-Differences.Rmd</code></div>

    </div>

    
    
<div id="two-stage-difference-in-differences-gardner-2021" class="section level2">
<h2 class="hasAnchor">
<a href="#two-stage-difference-in-differences-gardner-2021" class="anchor"></a>Two-stage Difference-in-differences, <a href="https://jrgcmu.github.io/2sdd_current.pdf">Gardner (2021)</a>
</h2>
<p>Researchers often want to estimate either a static TWFE model,</p>
<p><span class="math display">\[\begin{equation}
  y_{it} = \mu_i + \mu_t + \tau D_{it} + \varepsilon_{it},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\mu_i\)</span> are unit fixed effects, <span class="math inline">\(\mu_t\)</span> are time fixed effects, and <span class="math inline">\(D_{it}\)</span> is an indicator for receiving treatment, or an event-study TWFE model</p>
<p><span class="math display">\[\begin{equation}
y_{it} = \mu_i + \mu_t + \sum_{k = -L}^{-2} \tau^k D_{it}^k + \sum_{k = 1}^{K} \tau^k D_{it}^k + \varepsilon_{it},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(D_{it}^k\)</span> are lag/leads of treatment (k periods from initial treatment date).</p>
<aside>
Sometimes researches use variants of this model where they bin or drop leads and lags
</aside><p>However, running OLS to estimate either model has been shown to not recover an average treatment effect and has the potential to be severely misleading in cases of treatment effect heterogeneity [<a href="https://sites.google.com/view/borusyak/research">Borusyak et. al. (2021)</a>; <a href="(https://authors.elsevier.com/a/1cFzc15Dji4pnC)">Callaway and Sant’Anna (2020)</a>; <a href="https://doi.org/10.1257/aer.20181169">de Chaisemartin and d’Haultfoeuille (2020)</a>; <a href="http://goodman-bacon.com/pdfs/ddtiming.pdf">Goodman-Bacon (2020)</a>; <a href="http://economics.mit.edu/files/14964">Sun and Abraham (2020)</a>].</p>
<p>One way of thinking about this problem is through the FWL theorem. When estimating the unit and time fixed effects, you create a residualized <span class="math inline">\(\tilde{Y}_{it}\)</span> which is commonly said to be “the outcome variable after removing time shocks and fixed units characteristics”, but you also create a residulaized <span class="math inline">\(\tilde{D}_{it}\)</span> or <span class="math inline">\(\tilde{D}_{it}^k\)</span>. To simplify the literature, this residualized treatment indicators is what creates the problem of interpreting <span class="math inline">\(\tau\)</span> or <span class="math inline">\(\tau^k\)</span>, especially when treatment effects are heterogeneous.</p>
<p>That’s where <a href="https://jrgcmu.github.io/2sdd_current.pdf">Gardner (2021)</a> comes in. What Gardner does to fix the problem is quite simple: estimate <span class="math inline">\(\mu_i\)</span> and <span class="math inline">\(\mu_t\)</span> seperately so you don’t residualize the treatment indicators. In the absence of treatment, the TWFE model gives you a model for (potentially unobserved) untreated outcomes</p>
<p><span class="math display">\[y_{it}(0) = \mu_i + \mu_t + \varepsilon_{it}.\]</span></p>
<p>Therefore, if you can <strong><em>consistently</em></strong> estimate <span class="math inline">\(y_{it}(0)\)</span>, you can impute the untreated outcome and remove that from the observed outcome <span class="math inline">\(y_{it}\)</span>. The value of <span class="math inline">\(y_{it} - \hat{y}_{it}(0)\)</span> should be close to zero for control units and should be close to <span class="math inline">\(\tau_{it}\)</span> for treated observations. Then, regressing <span class="math inline">\(y_{it} - \hat{y}_{it}(0)\)</span> on the treatment variables should give unbiased estimates of treatment effects (either static or dynamic/event-study).</p>
<aside>
This is the same logic as the new paper <span class="citation">@Borusyak_Jaravel_Spiess_2021</span>
</aside><p>The steps of the two-step estimator are:</p>
<ol style="list-style-type: decimal">
<li><p>First estimate <span class="math inline">\(\mu_i\)</span> and <span class="math inline">\(\mu_t\)</span> using untreated/not-yet-treated observations, i.e. the subsample with <span class="math inline">\(D_{it}=0\)</span>. Residualize outcomes <span class="math inline">\(\tilde{y}_{it} = y_{it} - \hat{\mu}_i - \hat{\mu}_t\)</span>.</p></li>
<li><p>Regress <span class="math inline">\(\tilde{y}_{it}\)</span> on <span class="math inline">\(D_{it}\)</span> or <span class="math inline">\(D_{it}^k\)</span>’s to estimate the treatment effect <span class="math inline">\(\tau\)</span> or <span class="math inline">\(\tau^k\)</span>’s.</p></li>
</ol>
<p>Some notes:</p>
<div id="standard-errors" class="section level3">
<h3 class="hasAnchor">
<a href="#standard-errors" class="anchor"></a>Standard Errors</h3>
<p>First, the standard errors on <span class="math inline">\(\tau\)</span> or <span class="math inline">\(\tau^k\)</span>’s will be incorrect as the dependent variable is itself an estimate. This is referred to the generated regressor problem in econometrics parlance. Therefore, <a href="https://jrgcmu.github.io/2sdd_current.pdf">Gardner (2021)</a> has developed a GMM estimator that will give asymptotically correct standard errors.</p>
<aside>
Details are left to the paper, but are implemented in the R package
</aside>
</div>
<div id="anticipation" class="section level3">
<h3 class="hasAnchor">
<a href="#anticipation" class="anchor"></a>Anticipation</h3>
<p>Second, this procedure works so long as <span class="math inline">\(\mu_i\)</span> and <span class="math inline">\(\mu_t\)</span> are <strong><em>consistently</em></strong> estimated. The key is to use only untreated/not-yet-treated observations to estimate the fixed effects. For example, if you used observations with <span class="math inline">\(D_{it} = 1\)</span>, you would attribute treatment effects <span class="math inline">\(\tau\)</span> as “fixed characteristics” and would combine <span class="math inline">\(\mu_i\)</span> with the treatment effects.</p>
<p>The fixed effects could be biased/inconsistent if there are anticipation effects, i.e. units respond before treatment starts. The fix is fairly simple, simply “shift” treatment date earlier by as many years as you suspect anticipation to occur (e.g. 2 years before treatment starts) and estimate on the subsample where the shifted treatment equals zero.</p>
<aside>
The R package allows you to specify the variable <span class="math inline">\(D_{it}\)</span>, if you suspect anticipation, provide the shifted variable to this option.
</aside>
</div>
<div id="covariates" class="section level3">
<h3 class="hasAnchor">
<a href="#covariates" class="anchor"></a>Covariates</h3>
<p>This method works with pre-determined covariates as well. Augment the above step 1. to include <span class="math inline">\(X_i\)</span> and remove that from <span class="math inline">\(y_{it}\)</span> along with the fixed effects to get <span class="math inline">\(\tilde{y}_{it}\)</span>.</p>
</div>
</div>
<div id="r-package" class="section level2">
<h2 class="hasAnchor">
<a href="#r-package" class="anchor"></a>R Package</h2>
<p>I have created an R package with the help of John Gardner to estimate the two-stage procedure. To install the package, run the following:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span><span class="op">(</span><span class="st">"kylebutts/did2s"</span><span class="op">)</span></code></pre></div>
<p>To view the documentation, type <code><a href="../reference/did2s.html">?did2s</a></code> into the console.</p>
<p>The main function is <code>did2s</code> which estimates the two-stage did procedure. This function requires the following options:</p>
<ul>
<li>
<code>yname</code>: the outcome variable</li>
<li>
<code>first_stage_formula</code>: formula for first stage, can include fixed effects and covariates, but do not include treatment variable(s)!</li>
<li>
<code>treat_formula</code>: This should be the treatment variable or in the case of event studies, treatment variables.</li>
<li>
<code>treat_var</code>: This has to be the 0/1 treatment variable that marks when treatment turns on for a unit. If you suspect anticipation, see note above for accounting for this.</li>
<li>
<code>cluster_var</code>: Optional, this tells which variables to cluster on</li>
</ul>
<p>did2s returns a list with two objects:</p>
<ol style="list-style-type: decimal">
<li>fixest estimate for the second stage with corrected standard errors.</li>
</ol>
<div id="example-usage" class="section level3">
<h3 class="hasAnchor">
<a href="#example-usage" class="anchor"></a>Example Usage</h3>
<p>I will load example data from the package and plot the average outcome among the groups. Here is one unit’s data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.0 ──</span>
<span class="co">#&gt; ✓ ggplot2 3.3.3     ✓ purrr   0.3.4</span>
<span class="co">#&gt; ✓ tibble  3.1.2     ✓ dplyr   1.0.6</span>
<span class="co">#&gt; ✓ tidyr   1.1.3     ✓ stringr 1.4.0</span>
<span class="co">#&gt; ✓ readr   1.4.0     ✓ forcats 0.5.1</span>
<span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; x dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://kylebutts.com/did2s">did2s</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lrberge.github.io/fixest/">fixest</a></span><span class="op">)</span>
<span class="co">#&gt; fixest 0.9.0, BREAKING changes! </span>
<span class="co">#&gt; In i():</span>
<span class="co">#&gt;   a) the first two arguments have been swapped! Now it's i(factor_var, continuous_var) for interactions. </span>
<span class="co">#&gt;   b) argument 'drop' has been removed (put everything in 'ref' now).</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/rmarkdown">rmarkdown</a></span><span class="op">)</span>

<span class="co"># Load theme</span>
<span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/kylebutts/templates/master/ggplot_theme/theme_kyle.R"</span><span class="op">)</span>
<span class="co">#&gt; Loading required package: showtext</span>
<span class="co">#&gt; Loading required package: sysfonts</span>
<span class="co">#&gt; Loading required package: showtextdb</span>

<span class="co"># Load Data from R package</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"df_het"</span><span class="op">)</span>

<span class="co"># One observation</span>
<span class="va">df_het</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">31</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">rmarkdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgs.rstudio.com/rmarkdown/reference/paged_table.html">paged_table</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["unit"],"name":[1],"type":["int"],"align":["right"]},{"label":["state"],"name":[2],"type":["int"],"align":["right"]},{"label":["unit_fe"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["group"],"name":[4],"type":["chr"],"align":["left"]},{"label":["g"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["year"],"name":[6],"type":["int"],"align":["right"]},{"label":["year_fe"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["treat"],"name":[8],"type":["lgl"],"align":["right"]},{"label":["rel_year"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["rel_year_binned"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["error"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["te"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["te_dynamic"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["dep_var"],"name":[14],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"1990","7":"-1.40050826","8":"FALSE","9":"-10","10":"-6","11":"0.6145757","12":"0","13":"0.00","14":"4.737968"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"1991","7":"0.20254595","8":"FALSE","9":"-9","10":"-6","11":"-1.3742400","12":"0","13":"0.00","14":"4.352207"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"1992","7":"-1.86633937","8":"FALSE","9":"-8","10":"-6","11":"-0.5497449","12":"0","13":"0.00","14":"3.107816"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"1993","7":"0.74791903","8":"FALSE","9":"-7","10":"-6","11":"0.2012265","12":"0","13":"0.00","14":"6.473046"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"1994","7":"0.29174572","8":"FALSE","9":"-6","10":"-6","11":"1.5343242","12":"0","13":"0.00","14":"7.349971"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"1995","7":"-0.07528443","8":"FALSE","9":"-5","10":"-5","11":"0.8811842","12":"0","13":"0.00","14":"6.329800"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"1996","7":"1.06317582","8":"FALSE","9":"-4","10":"-4","11":"-0.8575802","12":"0","13":"0.00","14":"5.729496"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"1997","7":"0.75422147","8":"FALSE","9":"-3","10":"-3","11":"0.3724619","12":"0","13":"0.00","14":"6.650584"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"1998","7":"0.70147644","8":"FALSE","9":"-2","10":"-2","11":"3.0376125","12":"0","13":"0.00","14":"9.262990"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"1999","7":"0.64828085","8":"FALSE","9":"-1","10":"-1","11":"-0.4348458","12":"0","13":"0.00","14":"5.737336"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2000","7":"-0.86491184","8":"TRUE","9":"0","10":"0","11":"-0.6782561","12":"2","13":"0.00","14":"5.980733"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2001","7":"-0.68147084","8":"TRUE","9":"1","10":"1","11":"0.6084212","12":"2","13":"0.05","14":"7.500851"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2002","7":"-0.40851703","8":"TRUE","9":"2","10":"2","11":"-0.6967064","12":"2","13":"0.10","14":"6.518677"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2003","7":"0.44116551","8":"TRUE","9":"3","10":"3","11":"-0.3903801","12":"2","13":"0.15","14":"7.724686"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2004","7":"-1.89630806","8":"TRUE","9":"4","10":"4","11":"0.2949940","12":"2","13":"0.20","14":"6.122587"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2005","7":"-0.60094668","8":"TRUE","9":"5","10":"5","11":"-0.2986756","12":"2","13":"0.25","14":"6.874278"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2006","7":"-0.69171484","8":"TRUE","9":"6","10":"6","11":"2.2347539","12":"2","13":"0.30","14":"9.366940"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2007","7":"0.45735807","8":"TRUE","9":"7","10":"6","11":"1.4796393","12":"2","13":"0.35","14":"9.810898"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2008","7":"0.09452109","8":"TRUE","9":"8","10":"6","11":"1.1175902","12":"2","13":"0.40","14":"9.136012"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2009","7":"1.15085141","8":"TRUE","9":"9","10":"6","11":"1.5450265","12":"2","13":"0.45","14":"10.669779"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2010","7":"-0.87793651","8":"TRUE","9":"10","10":"6","11":"-0.7416351","12":"2","13":"0.50","14":"6.404329"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2011","7":"-0.40506525","8":"TRUE","9":"11","10":"6","11":"-0.8988126","12":"2","13":"0.55","14":"6.770023"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2012","7":"2.09741600","8":"TRUE","9":"12","10":"6","11":"-1.7152858","12":"2","13":"0.60","14":"8.506031"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2013","7":"-0.99467503","8":"TRUE","9":"13","10":"6","11":"0.2000256","12":"2","13":"0.65","14":"7.379251"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2014","7":"-0.60127527","8":"TRUE","9":"14","10":"6","11":"-0.5346511","12":"2","13":"0.70","14":"7.087974"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2015","7":"0.09296431","8":"TRUE","9":"15","10":"6","11":"-0.9842208","12":"2","13":"0.75","14":"7.382644"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2016","7":"0.25950820","8":"TRUE","9":"16","10":"6","11":"-1.7970712","12":"2","13":"0.80","14":"6.786338"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2017","7":"0.23363751","8":"TRUE","9":"17","10":"6","11":"0.5173953","12":"2","13":"0.85","14":"9.124934"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2018","7":"0.60420642","8":"TRUE","9":"18","10":"6","11":"-0.5704375","12":"2","13":"0.90","14":"8.457670"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2019","7":"-0.83127757","8":"TRUE","9":"19","10":"6","11":"-1.2716152","12":"2","13":"0.95","14":"6.371008"},{"1":"1","2":"29","3":"5.523901","4":"Group 1","5":"2000","6":"2020","7":"-0.75278479","8":"TRUE","9":"20","10":"6","11":"-1.8627070","12":"2","13":"1.00","14":"5.908409"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Here is a plot of the average outcome variable for each of the groups:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot Data </span>
<span class="va">df_avg</span> <span class="op">&lt;-</span> <span class="va">df_het</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">group</span>, <span class="va">year</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">summarize</span><span class="op">(</span>dep_var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">dep_var</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">'drop'</span><span class="op">)</span>

<span class="co"># Get treatment years for plotting</span>
<span class="va">gs</span> <span class="op">&lt;-</span> <span class="va">df_het</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">pull</span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span>
    
    
<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">geom_line</span><span class="op">(</span>data <span class="op">=</span> <span class="va">df_avg</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>y <span class="op">=</span> <span class="va">dep_var</span>, x <span class="op">=</span> <span class="va">year</span>, color <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">gs</span> <span class="op">-</span> <span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">theme_kyle</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>y <span class="op">=</span> <span class="st">"Outcome"</span>, x <span class="op">=</span> <span class="st">"Year"</span>, color <span class="op">=</span> <span class="st">"Treatment Cohort"</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">scale_y_continuous</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu">expansion</span><span class="op">(</span>add <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Group 1"</span> <span class="op">=</span> <span class="st">"#d2382c"</span>, <span class="st">"Group 2"</span> <span class="op">=</span> <span class="st">"#497eb3"</span>, <span class="st">"Group 3"</span> <span class="op">=</span> <span class="st">"#8e549f"</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<div class="figure">
<img src="Two-Stage-Difference-in-Differences_files/figure-html/plot-df-het-1.png" alt="Example data with heterogeneous treatment effects" width="768"><p class="caption">
Example data with heterogeneous treatment effects
</p>
</div>
</div>
<div id="estimate-two-stage-difference-in-differences" class="section level3">
<h3 class="hasAnchor">
<a href="#estimate-two-stage-difference-in-differences" class="anchor"></a>Estimate Two-stage Difference-in-Differences</h3>
<p>First, lets estimate a static did:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Static</span>
<span class="va">static</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/did2s.html">did2s</a></span><span class="op">(</span><span class="va">df_het</span>, 
                yname <span class="op">=</span> <span class="st">"dep_var"</span>, first_stage_formula <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html">i</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html">i</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, 
                treat_formula <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html">i</a></span><span class="op">(</span><span class="va">treat</span>, ref <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>, treat_var <span class="op">=</span> <span class="st">"treat"</span>, 
                cluster_var <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Two-stage Difference-in-Differences ─────────────────────────────────────────</span>
<span class="co">#&gt; → Running with first stage formula `~ i(state) + i(year)` and treat formula `~ i(treat, ref = FALSE)`</span>
<span class="co">#&gt; → The indicator variable that denotes when treatment is on is `treat`</span>
<span class="co">#&gt; → Standard errors will be clustered by `state`</span>
<span class="co">#&gt; ℹ For more information on the methodology, visit &lt;https://www.kylebutts.com/did2s&gt;</span>

<span class="fu">fixest</span><span class="fu">::</span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/etable.html">esttable</a></span><span class="op">(</span><span class="va">static</span><span class="op">)</span>
<span class="co">#&gt;                            static</span>
<span class="co">#&gt; Dependent Var.:           dep_var</span>
<span class="co">#&gt;                                  </span>
<span class="co">#&gt; treat = TRUE    2.380*** (0.0614)</span>
<span class="co">#&gt; _______________ _________________</span>
<span class="co">#&gt; S.E. type                  Custom</span>
<span class="co">#&gt; Observations               31,000</span>
<span class="co">#&gt; R2                        0.28955</span>
<span class="co">#&gt; Adj. R2                   0.28955</span></code></pre></div>
<p>Then, let’s estimate an event study did:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Event Study</span>
<span class="va">es</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/did2s.html">did2s</a></span><span class="op">(</span><span class="va">df_het</span>,
            yname <span class="op">=</span> <span class="st">"dep_var"</span>, first_stage_formula <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html">i</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html">i</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, 
            treat_formula <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="https://lrberge.github.io/fixest/reference/i.html">i</a></span><span class="op">(</span><span class="va">rel_year</span>, ref<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span>, treat_var <span class="op">=</span> <span class="st">"treat"</span>, 
            cluster_var <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ── Two-stage Difference-in-Differences ─────────────────────────────────────────</span>
<span class="co">#&gt; → Running with first stage formula `~ i(state) + i(year)` and treat formula `~ i(rel_year, ref = c(-1, Inf))`</span>
<span class="co">#&gt; → The indicator variable that denotes when treatment is on is `treat`</span>
<span class="co">#&gt; → Standard errors will be clustered by `state`</span>
<span class="co">#&gt; ℹ For more information on the methodology, visit &lt;https://www.kylebutts.com/did2s&gt;</span>

<span class="fu">fixest</span><span class="fu">::</span><span class="fu"><a href="https://lrberge.github.io/fixest/reference/etable.html">esttable</a></span><span class="op">(</span><span class="va">es</span><span class="op">)</span>
<span class="co">#&gt;                                 es</span>
<span class="co">#&gt; Dependent Var.:            dep_var</span>
<span class="co">#&gt;                                   </span>
<span class="co">#&gt; rel_year = -20     0.0495 (0.0795)</span>
<span class="co">#&gt; rel_year = -19    0.1550. (0.0793)</span>
<span class="co">#&gt; rel_year = -18     0.0429 (0.0862)</span>
<span class="co">#&gt; rel_year = -17     0.0798 (0.0805)</span>
<span class="co">#&gt; rel_year = -16     0.1023 (0.0882)</span>
<span class="co">#&gt; rel_year = -15    0.2164* (0.0948)</span>
<span class="co">#&gt; rel_year = -14    0.1708* (0.0839)</span>
<span class="co">#&gt; rel_year = -13     0.0940 (0.0806)</span>
<span class="co">#&gt; rel_year = -12     0.0899 (0.0840)</span>
<span class="co">#&gt; rel_year = -11    0.1976* (0.0800)</span>
<span class="co">#&gt; rel_year = -10     0.0953 (0.0619)</span>
<span class="co">#&gt; rel_year = -9      0.0513 (0.0586)</span>
<span class="co">#&gt; rel_year = -8     0.0878* (0.0403)</span>
<span class="co">#&gt; rel_year = -7   0.1542*** (0.0440)</span>
<span class="co">#&gt; rel_year = -6      0.0221 (0.0510)</span>
<span class="co">#&gt; rel_year = -5      0.0351 (0.0490)</span>
<span class="co">#&gt; rel_year = -4     -0.0508 (0.0505)</span>
<span class="co">#&gt; rel_year = -3     -0.0094 (0.0496)</span>
<span class="co">#&gt; rel_year = -2      0.0089 (0.0565)</span>
<span class="co">#&gt; rel_year = 0     1.727*** (0.0827)</span>
<span class="co">#&gt; rel_year = 1     1.752*** (0.0798)</span>
<span class="co">#&gt; rel_year = 2     1.871*** (0.0930)</span>
<span class="co">#&gt; rel_year = 3     1.918*** (0.0755)</span>
<span class="co">#&gt; rel_year = 4     1.940*** (0.0842)</span>
<span class="co">#&gt; rel_year = 5     2.146*** (0.0847)</span>
<span class="co">#&gt; rel_year = 6     2.180*** (0.0920)</span>
<span class="co">#&gt; rel_year = 7     2.348*** (0.0818)</span>
<span class="co">#&gt; rel_year = 8     2.413*** (0.0764)</span>
<span class="co">#&gt; rel_year = 9     2.620*** (0.1075)</span>
<span class="co">#&gt; rel_year = 10    2.681*** (0.0954)</span>
<span class="co">#&gt; rel_year = 11    2.712*** (0.1204)</span>
<span class="co">#&gt; rel_year = 12    2.672*** (0.1533)</span>
<span class="co">#&gt; rel_year = 13    2.656*** (0.1225)</span>
<span class="co">#&gt; rel_year = 14    2.755*** (0.1293)</span>
<span class="co">#&gt; rel_year = 15    2.823*** (0.1341)</span>
<span class="co">#&gt; rel_year = 16    2.694*** (0.1200)</span>
<span class="co">#&gt; rel_year = 17    2.897*** (0.1266)</span>
<span class="co">#&gt; rel_year = 18    3.130*** (0.1160)</span>
<span class="co">#&gt; rel_year = 19    3.231*** (0.1235)</span>
<span class="co">#&gt; rel_year = 20    3.308*** (0.1120)</span>
<span class="co">#&gt; _______________ __________________</span>
<span class="co">#&gt; S.E. type                   Custom</span>
<span class="co">#&gt; Observations                31,000</span>
<span class="co">#&gt; R2                         0.30589</span>
<span class="co">#&gt; Adj. R2                    0.30501</span></code></pre></div>
<p>And plot the results:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">es</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu">str_detect</span><span class="op">(</span><span class="va">term</span>, <span class="st">"rel_year::"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">select</span><span class="op">(</span>rel_year <span class="op">=</span> <span class="va">term</span>, <span class="va">estimate</span>, se <span class="op">=</span> <span class="va">std.error</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">mutate</span><span class="op">(</span>
        rel_year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu">str_remove</span><span class="op">(</span><span class="va">rel_year</span>, <span class="st">"rel_year::"</span><span class="op">)</span><span class="op">)</span>,
        ci_lower <span class="op">=</span> <span class="va">estimate</span> <span class="op">-</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se</span>,
        ci_upper <span class="op">=</span> <span class="va">estimate</span> <span class="op">+</span> <span class="fl">1.96</span> <span class="op">*</span> <span class="va">se</span>,
        group <span class="op">=</span> <span class="st">"Estimated Effect"</span>
    <span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">rel_year</span> <span class="op">&lt;=</span> <span class="fl">8</span> <span class="op">&amp;</span> <span class="va">rel_year</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">8</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span>rel_year <span class="op">=</span> <span class="va">rel_year</span> <span class="op">+</span> <span class="fl">0.05</span><span class="op">)</span>

<span class="va">te_true</span> <span class="op">&lt;-</span> <span class="va">df_het</span> <span class="op">%&gt;%</span>
    <span class="co"># Keep only treated units</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">g</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">group_by</span><span class="op">(</span><span class="va">rel_year</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu">summarize</span><span class="op">(</span>estimate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">te</span> <span class="op">+</span> <span class="va">te_dynamic</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
      <span class="fu">mutate</span><span class="op">(</span>group <span class="op">=</span> <span class="st">"True Effect"</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">rel_year</span> <span class="op">&gt;=</span> <span class="op">-</span><span class="fl">8</span> <span class="op">&amp;</span> <span class="va">rel_year</span> <span class="op">&lt;=</span> <span class="fl">8</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">mutate</span><span class="op">(</span>rel_year <span class="op">=</span> <span class="va">rel_year</span> <span class="op">-</span> <span class="fl">0.05</span><span class="op">)</span>

<span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">pts</span>, <span class="va">te_true</span><span class="op">)</span>

<span class="va">max_y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">pts</span><span class="op">$</span><span class="va">estimate</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="co"># 0 effect</span>
    <span class="fu">geom_hline</span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">0</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span>
    <span class="co"># Confidence Intervals</span>
    <span class="fu">geom_linerange</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">rel_year</span>, ymin <span class="op">=</span> <span class="va">ci_lower</span>, ymax <span class="op">=</span> <span class="va">ci_upper</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"grey30"</span><span class="op">)</span> <span class="op">+</span>
    <span class="co"># Estimates</span>
    <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pts</span>, mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">rel_year</span>, y <span class="op">=</span> <span class="va">estimate</span>, color <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="co"># Label</span>
    <span class="fu">geom_label</span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">-</span> <span class="fl">0.1</span>, y <span class="op">=</span> <span class="va">max_y</span> <span class="op">+</span> <span class="fl">0.25</span>, label <span class="op">=</span> <span class="st">"Treatment Starts ▶"</span><span class="op">)</span>, label.size<span class="op">=</span><span class="cn">NA</span>,
               mapping <span class="op">=</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, label <span class="op">=</span> <span class="va">label</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">5.5</span>, hjust <span class="op">=</span> <span class="fl">1</span>, fontface <span class="op">=</span> <span class="fl">2</span>, inherit.aes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_x_continuous</span><span class="op">(</span>breaks <span class="op">=</span> <span class="op">-</span><span class="fl">8</span><span class="op">:</span><span class="fl">8</span>, minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_y_continuous</span><span class="op">(</span>minor_breaks <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">scale_color_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Estimated Effect"</span> <span class="op">=</span> <span class="st">"#013ef5"</span>, <span class="st">"True Effect"</span> <span class="op">=</span> <span class="st">"#eb3f25"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Relative Time"</span>, y <span class="op">=</span> <span class="st">"Estimate"</span>, color <span class="op">=</span> <span class="cn">NULL</span>, title <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme_kyle</span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span>
<span class="co">#&gt; Warning: Removed 17 rows containing missing values (geom_segment).</span></code></pre></div>
<div class="figure">
<img src="Two-Stage-Difference-in-Differences_files/figure-html/plot-es-1.png" alt="Event-study plot with example data" width="768"><p class="caption">
Event-study plot with example data
</p>
</div>
</div>
</div>
<div id="references" class="section level1">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<ul>
<li><p><a href="">Borusyak, Kirill, Xavier Jaravel, and Jann Spiess. 2021. “Revisiting Event Study Designs: Robust and Efficient Estimation,” 48.</a></p></li>
<li><p><a href="https://authors.elsevier.com/a/1cFzc15Dji4pnC">Callaway, Brantly, and Pedro H. C. Sant’Anna. “Difference-in-differences with multiple time periods.” Forthcoming at the Journal of Econometrics (2020)</a>.</p></li>
<li><p><a href="https://doi.org/10.1257/aer.20181169">de Chaisemartin, Clement, and Xavier d’Haultfoeuille. “Two-way fixed effects estimators with heterogeneous treatment effects.” American Economic Review 110.9 (2020): 2964-96.</a></p></li>
<li><p><a href="https://jrgcmu.github.io/2sdd_current.pdf">Gardner, John. 2021. “Two-Stage Difference-in-Differences.” Working Paper</a></p></li>
<li><p><a href="http://goodman-bacon.com/pdfs/ddtiming.pdf">Goodman-Bacon, Andrew. Difference-in-differences with variation in treatment timing." Working Paper, 2020</a></p></li>
<li><p><a href="http://economics.mit.edu/files/14964">Sun, Liyang, and Sarah Abraham. “Estimating dynamic treatment effects in event studies with heterogeneous treatment effects.” Forthcoming at the Journal of Econometrics (2020).</a></p></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kyle Butts.</p>
</div>

<div class="pkgdown">
  <p>Made with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1, using <a href="https://preferably.amirmasoudabdol.name/?source=footer">preferably</a> template.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
